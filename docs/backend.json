{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user in the Cascade Rewards application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user."
        },
        "googleId": {
          "type": "string",
          "description": "Google ID to connect to google authentication system."
        },
        "email": {
          "type": "string",
          "description": "User's email address.",
          "format": "email"
        },
        "referralCode": {
          "type": "string",
          "description": "Unique referral code for the user."
        },
        "points": {
          "type": "number",
          "description": "Total points earned by the user."
        },
        "referrerId": {
          "type": "string",
          "description": "Reference to the user who referred this user. (Relationship: User 1:N User (referrals))"
        }
      },
      "required": [
        "id",
        "googleId",
        "email",
        "referralCode",
        "points"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles. Includes `googleId` to enable secure authentication via Google Sign-In without additional reads in security rules.",
          "params": [
            {
              "name": "userId",
              "description": "Unique identifier for the user, corresponding to their Firebase Auth UID."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to ensure authorization independence, clarity, and scalability. It leverages path-based ownership for user data and denormalization to avoid hierarchical `get()` calls in security rules, which enhances atomicity and simplifies debugging. The structure also promotes homogeneous security posture by segregating data based on access requirements.\n\nAuthorization Independence is achieved by storing the `googleId` on the `users/{userId}` document to avoid calls to Firebase Authentication.\n\nQAPs (Rules are not Filters) is supported via structural segregation based on path-based ownership. Listing user documents is restricted to admins or the user themselves. The structure will be extended as new features are added to ensure authorization is independent from filtering. All documents in a collection share the same security requirements."
  }
}